import torch
import json
from transformers import T5ForConditionalGeneration, T5Tokenizer

# 模型的路径，10000表示10000步训练
tokenizer = T5Tokenizer.from_pretrained("E:\\DSI\\My_DSI\\10000")
model = T5ForConditionalGeneration.from_pretrained("E:\\DSI\\My_DSI\\10000")


query = r"\u4e00\u5ba1\u6cd5\u9662\u8ba4\u5b9a\u4e8b\u5b9e\uff1a2017\u5e745\u670819\u65e5\uff0c\u5468\u5982\u5f3a\u4f5c\u4e3a\u7532\u65b9\u3001\u66f9\u4e16\u6625\u4f5c\u4e3a\u4e59\u65b9\u3001\u677e\u6749\u4f73\u5349\u516c\u53f8\u4f5c\u4e3a\u62c5\u4fdd\u4eba\u7b7e\u8ba2\u51fa\u501f\u672c\u91d1\u91d1\u989d\u4e3a20\u4e07\u5143\u3001\u501f\u6b3e\u671f\u9650\u4e3a2017\u5e745\u670819\u65e5\u81f32018\u5e745\u670818\u65e5\u3001\u5e74\u5229\u7387\u4e3a15%\u7684\u300a\u80b2\u82d7\u501f\u6b3e\u300b\u5408\u540c\uff0c\u524d\u8ff0\u5408\u540c\u6d89\u53ca\u7684\u51fa\u501f\u6b3e\u9879\u7684\u8f6c\u8d26\u8bb0\u5f55\u4e3a\uff1a2017\u5e745\u670819\u65e510\u65f641\u520629\u79d2\u4ece\u5468\u5982\u5f3a\u5728\u4e2d\u56fd\u5de5\u5546\u94f6\u884c\u5f00\u7acb\u7684\u8d26\u53f7\u4e3a\u00d7\u00d7\u00d7\u7684\u94f6\u884c\u8d26\u6237\u5411\u677e\u6749\u4f73\u5349\u516c\u53f8\u5728\u4e2d\u56fd\u519c\u4e1a\u94f6\u884c\u7684\u8d26\u6237\u8f6c\u8d2620\u4e07\u5143\u30022017\u5e745\u670825\u65e5\uff0c\u5468\u5982\u5f3a\u4f5c\u4e3a\u7532\u65b9\u3001\u66f9\u4e16\u6625\u4f5c\u4e3a\u4e59\u65b9\u3001\u677e\u6749\u4f73\u5349\u516c\u53f8\u4f5c\u4e3a\u62c5\u4fdd\u4eba\u7b7e\u8ba2\u51fa\u501f\u672c\u91d1\u91d1\u989d\u4e3a30\u4e07\u5143\u3001\u501f\u6b3e\u671f\u9650\u4e3a2017\u5e745\u670825\u65e5\u81f32018\u5e745\u670825\u65e5\u3001\u5e74\u5229\u7387\u4e3a15%\u7684\u300a\u80b2\u82d7\u501f\u6b3e\u300b\u5408\u540c\uff0c\u524d\u8ff0\u5408\u540c\u6d89\u53ca\u7684\u51fa\u501f\u6b3e\u9879\u7684\u8f6c\u8d26\u8bb0\u5f55\u4e3a\uff1a1.2017\u5e745\u670824\u65e515\u65f650\u520648\u79d2\uff0c\u4ece\u5468\u5982\u5f3a\u5728\u4e2d\u56fd\u5de5\u5546\u94f6\u884c\u5f00\u7acb\u7684\u8d26\u53f7\u4e3a\u00d7\u00d7\u00d7\u7684\u94f6\u884c\u8d26\u6237\u5411\u677e\u6749\u4f73\u5349\u516c\u53f8\u5728\u4e2d\u56fd\u519c\u4e1a\u94f6\u884c\u7684\u8d26\u6237\u8f6c\u8d2612\u4e07\u5143\u30022.2017\u5e745\u670824\u65e515\u65f652\u520606\u79d2\uff0c\u4ece\u5468\u5982\u5f3a\u4e4b\u5973\u5468\u6653\u65b9\u5728\u4e2d\u56fd\u5de5\u5546\u94f6\u884c\u5f00\u7acb\u7684\u8d26\u53f7\u4e3a\u00d7\u00d7\u00d7\u7684\u94f6\u884c\u8d26\u6237\u5411\u677e\u6749\u4f73\u5349\u516c\u53f8\u5728\u4e2d\u56fd\u519c\u4e1a\u94f6\u884c\u7684\u8d26\u6237\u8f6c\u8d2618\u4e07\u5143\u30022017\u5e747\u67086\u65e5\uff0c\u5468\u5982\u5f3a\u4f5c\u4e3a\u7532\u65b9\u3001\u66f9\u4e16\u6625\u4f5c\u4e3a\u4e59\u65b9\u3001\u677e\u6749\u4f73\u5349\u516c\u53f8\u4f5c\u4e3a\u62c5\u4fdd\u4eba\u7b7e\u8ba2\u51fa\u501f\u672c\u91d1\u91d1\u989d\u4e3a50\u4e07\u5143\u3001\u501f\u6b3e\u671f\u9650\u4e3a2017\u5e747\u67086\u65e5\u81f32018\u5e747\u67086\u65e5\u3001\u5e74\u5229\u7387\u4e3a15%\u7684\u300a\u80b2\u82d7\u501f\u6b3e\u300b\u5408\u540c\uff0c\u524d\u8ff0\u5408\u540c\u6d89\u53ca\u7684\u51fa\u501f\u6b3e\u9879\u7684\u8f6c\u8d26\u8bb0\u5f55\u4e3a\uff1a2017\u5e747\u67086\u65e510\u65f629\u520632\u79d2\u4ece\u5468\u5982\u5f3a\u5728\u4e2d\u56fd\u5de5\u5546\u94f6\u884c\u5f00\u7acb\u7684\u8d26\u53f7\u4e3a\u00d7\u00d7\u00d7\u7684\u94f6\u884c\u8d26\u6237\u5411\u677e\u6749\u4f73\u5349\u516c\u53f8\u5728\u4e2d\u56fd\u519c\u4e1a\u94f6\u884c\u7684\u8d26\u6237\u8f6c\u8d2650\u4e07\u5143\u30022017\u5e748\u67084\u65e5\uff0c\u5468\u5982\u5f3a\u4f5c\u4e3a\u7532\u65b9\u3001\u66f9\u4e16\u6625\u4f5c\u4e3a\u4e59\u65b9\u3001\u677e\u6749\u4f73\u5349\u516c\u53f8\u4f5c\u4e3a\u62c5\u4fdd\u4eba\u7b7e\u8ba2\u51fa\u501f\u672c\u91d1\u91d1\u989d\u4e3a20\u4e07\u5143\u3001\u501f\u6b3e\u671f\u9650\u4e3a2017\u5e748\u67084\u65e5\u81f32018\u5e748\u67084\u65e5\u3001\u5e74\u5229\u7387\u4e3a15%\u7684\u300a\u80b2\u82d7\u501f\u6b3e\u300b\u5408\u540c\uff0c\u524d\u8ff0\u5408\u540c\u6d89\u53ca\u7684\u51fa\u501f\u6b3e\u9879\u7684\u8f6c\u8d26\u8bb0\u5f55\u4e3a\uff1a2017\u5e748\u67084\u65e59\u65f649\u520612\u79d2\u4ece\u5468\u5982\u5f3a\u5728\u4e2d\u56fd\u5de5\u5546\u94f6\u884c\u5f00\u7acb\u7684\u8d26\u53f7\u4e3a\u00d7\u00d7\u00d7\u7684\u94f6\u884c\u8d26\u6237\u5411\u677e\u6749\u4f73\u5349\u516c\u53f8\u5728\u4e2d\u56fd\u519c\u4e1a\u94f6\u884c\u7684\u8d26\u6237\u8f6c\u8d2620\u4e07\u5143\u3002\u5468\u5982\u5f3a\u8ba4\u53ef\u5176\u66fe\u7ecf\u6536\u5230\u66f9\u4e16\u6625\uff08\u5177\u4f53\u8f6c\u51fa\u8d26\u6237\u5176\u4e0d\u6e05\u695a\uff09\u652f\u4ed8\u7684\u501f\u6b3e\u5229\u606f5\u4e07\u5143\uff0c\u677e\u6749\u4f73\u5349\u516c\u53f8\u8ba4\u53ef\u524d\u8ff0\u4e8b\u5b9e\u4f46\u4ea6\u8868\u793a\u524d\u8ff0\u501f\u6b3e\u5229\u606f5\u4e07\u5143\u5177\u4f53\u4ece\u54ea\u4e2a\u8d26\u6237\u8f6c\u51fa\u4ea6\u4e0d\u6e05\u695a\uff0c\u6b64\u5916\uff0c\u677e\u6749\u4f73\u5349\u516c\u53f8\u8ba4\u53ef\u9664\u4e86\u524d\u8ff05\u4e07\u5143\u5229\u606f\u4ee5\u5916\uff0c\u672a\u66fe\u5411\u5468\u5982\u5f3a\u652f\u4ed8\u8fc7\u5176\u5b83\u5229\u606f\u30022.2017\u5e745\u670825\u65e5\u672c\u91d130\u4e07\u5143\u7684\u501f\u6b3e\u57282018\u5e745\u670825\u65e5\u5230\u671f\uff0c\u524d\u8ff0\u6b3e\u9879\u7684\u903e\u671f\u5229\u606f\u8ba1\u7b97\u65f6\u95f4\u6bb5\u4e3a2018\u5e745\u670825\u65e5\u81f32018\u5e7410\u670830\u65e5\uff0c\u7d2f\u8ba1\u903e\u671f157\u5929\uff0c\u524d\u8ff0\u501f\u6b3e\u903e\u671f\u5229\u606f\u7684\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a30\u4e07\u5143\u00d715%\u00f7365\u5929\u00d7157\u5929\uff1d19356.16\u5143\u3002\u5468\u5982\u5f3a\u5c31\u5176\u8981\u6c42\u652f\u4ed8\u7684\u903e\u671f\u5229\u606f63452\u5143\u5177\u4f53\u6838\u7b97\u4f9d\u636e\u89e3\u91ca\u8bf4\u660e\u5982\u4e0b\uff1a1.2017\u5e745\u670819\u65e5\u672c\u91d120\u4e07\u5143\u7684\u501f\u6b3e\u57282018\u5e745\u670818\u65e5\u5230\u671f\uff0c\u524d\u8ff0\u6b3e\u9879\u7684\u903e\u671f\u5229\u606f\u8ba1\u7b97\u65f6\u95f4\u6bb5\u4e3a2018\u5e745\u670819\u65e5\u81f32018\u5e7410\u670830\u65e5\uff08\u8d77\u8bc9\u4e4b\u65e5\uff09\uff0c\u7d2f\u8ba1\u903e\u671f163\u5929\uff0c\u524d\u8ff0\u501f\u6b3e\u903e\u671f\u5229\u606f\u7684\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a20\u4e07\u5143\u00d715%\u00f7365\u5929\u00d7163\u5929\uff1d13397.26\u5143\u30023.2017\u5e747\u67086\u65e5\u672c\u91d150\u4e07\u5143\u7684\u501f\u6b3e\u57282018\u5e747\u67085\u65e5\u5230\u671f\uff0c\u524d\u8ff0\u6b3e\u9879\u7684\u903e\u671f\u5229\u606f\u8ba1\u7b97\u65f6\u95f4\u6bb5\u4e3a2018\u5e747\u67086\u65e5\u81f32018\u5e7410\u670830\u65e5\uff0c\u7d2f\u8ba1\u903e\u671f115\u5929\uff0c\u524d\u8ff0\u501f\u6b3e\u903e\u671f\u5229\u606f\u7684\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a50\u4e07\u5143\u00d715%\u00f7365\u5929\u00d7115\u5929\uff1d23630.13\u5143\u30024.2017\u5e748\u67084\u65e5\u672c\u91d120\u4e07\u5143\u7684\u501f\u6b3e\u57282018\u5e748\u67084\u65e5\u5230\u671f\uff0c\u524d\u8ff0\u6b3e\u9879\u7684\u903e\u671f\u5229\u606f\u8ba1\u7b97\u65f6\u95f4\u6bb5\u4e3a2018\u5e748\u67084\u65e5\u81f32018\u5e7410\u670830\u65e5\uff0c\u7d2f\u8ba1\u903e\u671f86\u5929\uff0c\u524d\u8ff0\u501f\u6b3e\u903e\u671f\u5229\u606f\u7684\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a20\u4e07\u5143\u00d715%\u00f7365\u5929\u00d786\u5929\uff1d7068.49\u5143\u30025.\u4ee5\u4e0a\u56db\u7b14\u501f\u6b3e\u7684\u903e\u671f\u5229\u606f\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a13397.26\u5143+19356.16\u5143+23630.13\u5143+7068.49\u5143=63452.04\u5143\u3002\u5468\u5982\u5f3a\u5728\u5176\u8bc9\u8bbc\u8bf7\u6c42\u4e2d\u5c06\u524d\u8ff0\u6570\u989d\u53d6\u6574\u540e\u4e3b\u5f20\u524d\u8ff0\u56db\u7b14\u501f\u6b3e\u8ba1\u7b97\u81f32018\u5e7410\u670830\u65e5\u7684\u903e\u671f\u5229\u606f\u5408\u8ba1\u4e3a63452\u5143\u3002\u4e8c\u5ba1\u7ecf\u67e5\uff0c2017\u5e745\u670819\u65e5\u30012017\u5e747\u67086\u65e5\u30012017\u5e748\u67084\u65e5\u7684\u300a\u80b2\u82d7\u501f\u6b3e\u300b\u5408\u540c\u7532\u65b9\u7b7e\u5b57\u5904\u5199\u660e\u201c\u5468\u6653\u4e1c\u4ee3\u201d\u5b57\u6837\uff0c2017\u5e745\u670825\u65e5\u7684\u300a\u80b2\u82d7\u501f\u6b3e\u300b\u5408\u540c\u7532\u65b9\u7b7e\u5b57\u5904\u5199\u660e\u201c\u5468\u6653\u4e1c\u4ee3\u5468\u5982\u5f3a\u201d\u5b57\u6837\u3002\u4e8c\u5ba1\u7ecf\u8be2\uff0c\u5468\u6653\u4e1c\u8ba4\u53ef\u6d89\u6848\u56db\u4efd\u300a\u80b2\u82d7\u501f\u6b3e\u300b\u5408\u540c\u7b7e\u5b57\u662f\u5176\u6240\u7b7e\uff0c\u7cfb\u4ee3\u8868\u5176\u7236\u5468\u5982\u5f3a\u7684\u610f\u601d\u3002"


input = tokenizer.encode(query, truncation=True, padding=True, max_length=512, add_special_tokens=True)
input_ids = torch.IntTensor([input])
outputs = model.generate(input_ids=input_ids, max_length=512)
id = tokenizer.decode(outputs[0], skip_special_tokens=True)

# 'Muser_10k_multi_task_train.json'是用于训练的库，最初的数据是case_pool.json 经过处理后为该json文件，此处的处理为k-means聚类，递归生成一个新的docid
f = open('Muser_10k_multi_task_train.json', 'r')
for line in f.readlines():
    dic = json.loads(line)
    if dic['text_id'] == str(id):
        print(dic['text'])
        break
